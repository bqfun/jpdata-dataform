config {
  type: "assertion",
  schema: "houjinbangou_staging",
  tags: ["daily"]
}

SELECT
  COUNT(*) AS num_rows,
  CURRENT_DATE("Asia/Tokyo") - MAX(update_date) AS delay,
FROM
  ${ref("houjinbangou_staging", "change_history_diff_stg")}
HAVING
  num_rows < 4157430 -- 2022-11-13時点の行数
  OR INTERVAL 3 DAY < delay
